<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DropCharge Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/styles.css" />
  <link rel="stylesheet" href="./assets/admin.css" />
</head>
<body class="admin">
  <div class="admin-shell">
    <aside class="admin-sidebar">
      <div class="sidebar-head">
        <h1>DropCharge</h1>
        <p class="micro">Admin Dashboard</p>
        <button class="btn mini ghost" id="admin-logout">Logout</button>
      </div>
      <nav class="admin-nav" role="tablist">
        <button class="nav-link active" data-tab="dashboard">Dashboard</button>
        <button class="nav-link" data-tab="newsletter">Newsletter</button>
        <button class="nav-link" data-tab="email">Email</button>
        <button class="nav-link" data-tab="campaigns">Campaigns</button>
        <button class="nav-link" data-tab="deals">Deals</button>
        <button class="nav-link" data-tab="drops">Gaming Drops</button>
        <button class="nav-link" data-tab="spotlight">Spotlight</button>
        <button class="nav-link" data-tab="tracking">Tracking Links</button>
        <button class="nav-link" data-tab="analytics">Analytics</button>
      </nav>
      <div class="sidebar-footer">
        <a class="btn ghost" href="/" target="_blank">‚Üê Back to Site</a>
      </div>
    </aside>

    <main class="admin-main">
      <!-- Neon News Ticker Banner -->
      <div id="neon-news-banner" class="neon-banner" style="display:none;">
        <div class="neon-banner-inner">
          <span class="neon-banner-icon">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="News alert"><path d="M9.5 1L4 9h4l-1.5 6L13 7H9l.5-6z" fill="currentColor"/></svg>
          </span>
          <div class="neon-banner-track">
            <span class="neon-banner-text" id="neon-banner-text"></span>
          </div>
        </div>
      </div>

      <!-- Dashboard Overview -->
      <section class="tab-panel active" data-panel="dashboard">
        <div class="panel-head">
          <h2>Dashboard</h2>
        </div>
        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-label">Total Subscribers</span>
            <strong class="stat-value" id="stat-total-subscribers">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Active Subscribers</span>
            <strong class="stat-value" id="stat-active-subscribers">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Unsubscribed</span>
            <strong class="stat-value" id="stat-unsubscribed">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Clicks (24h)</span>
            <strong class="stat-value" id="stat-clicks-24h">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Events (24h)</span>
            <strong class="stat-value" id="stat-events-24h">‚Äì</strong>
          </div>
        </div>

        <!-- Admin Settings: News Banner -->
        <div class="card">
          <h3>‚ö° News Banner</h3>
          <form id="banner-settings-form" class="card-form" style="border:none;padding:0;">
            <label class="form-field">
              <span>News Banner Text</span>
              <input type="text" id="banner-text-input" placeholder="Flash Deal ends tonight ‚Äì 20% boost active ‚ö°" />
            </label>
            <div class="form-actions">
              <button type="submit" class="btn primary">Save Banner</button>
              <button type="button" class="btn ghost" id="banner-clear-btn">Clear Banner</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Newsletter Manager -->
      <section class="tab-panel" data-panel="newsletter">
        <div class="panel-head">
          <h2>Newsletter Subscribers</h2>
          <div class="head-actions">
            <button class="btn mini" id="newsletter-export">Export CSV</button>
          </div>
        </div>
        <div class="filter-bar">
          <input type="search" id="subscriber-search" placeholder="Search by email‚Ä¶" />
          <select id="subscriber-status-filter">
            <option value="all">All</option>
            <option value="active" selected>Active</option>
            <option value="unsubscribed">Unsubscribed</option>
            <option value="bounced">Bounced</option>
          </select>
          <button class="btn mini ghost" id="subscriber-load">Search</button>
        </div>
        <div class="data-table" id="subscriber-table">
          <div class="table-head">
            <span>Email</span>
            <span>Status</span>
            <span>Source</span>
            <span>Prize</span>
            <span>Created</span>
          </div>
          <div class="table-body" id="subscriber-rows">
            <p class="empty">Loading subscribers‚Ä¶</p>
          </div>
        </div>
      </section>

      <!-- Email Hub -->
      <section class="tab-panel" data-panel="email">
        <div class="panel-head">
          <h2>Email</h2>
        </div>

        <!-- Audience Overview -->
        <div class="card">
          <h3>üìä Audience Overview</h3>
          <div class="stats-row">
            <div class="stat-card">
              <span class="stat-label">Active</span>
              <strong class="stat-value" id="email-stat-active">‚Äì</strong>
            </div>
            <div class="stat-card">
              <span class="stat-label">Unsubscribed</span>
              <strong class="stat-value" id="email-stat-unsub">‚Äì</strong>
            </div>
            <div class="stat-card">
              <span class="stat-label">Emails Sent (Total)</span>
              <strong class="stat-value" id="email-stat-sent">‚Äì</strong>
            </div>
            <div class="stat-card">
              <span class="stat-label">Failed</span>
              <strong class="stat-value" id="email-stat-failed">‚Äì</strong>
            </div>
          </div>
        </div>

        <!-- Templates -->
        <div class="card">
          <h3>üìß Templates</h3>
          <div id="email-templates-list" class="email-templates-grid">
            <p class="empty">Loading templates‚Ä¶</p>
          </div>
        </div>

        <!-- Template Preview -->
        <div class="card" id="email-template-preview-card" style="display:none;">
          <h3>Preview: <span id="email-preview-name"></span></h3>
          <div class="email-preview-actions" style="margin-bottom:0.75rem;">
            <button class="btn mini ghost" id="email-copy-html">Copy HTML</button>
            <button class="btn mini ghost" id="email-download-html">Download .html</button>
          </div>
          <div class="email-preview-frame-wrap">
            <iframe id="email-preview-frame" class="email-preview-frame"></iframe>
          </div>
        </div>

        <!-- Send Test Email -->
        <div class="card">
          <h3>üß™ Send Test Email</h3>
          <form id="email-test-form" class="card-form" style="border:none;padding:0;">
            <div class="form-row">
              <label class="form-field">
                <span>Template</span>
                <select id="email-test-template">
                  <option value="welcome">Welcome Email</option>
                  <option value="flash_deal">Flash Deal</option>
                  <option value="weekly_digest">Weekly Digest</option>
                  <option value="price_drop">Price Drop Alert</option>
                  <option value="gaming_drop">Gaming Drop</option>
                </select>
              </label>
              <label class="form-field">
                <span>Recipient</span>
                <input type="email" id="email-test-recipient" placeholder="test@example.com" required />
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn primary">Send Test</button>
            </div>
          </form>
        </div>

        <!-- Email Logs -->
        <div class="card">
          <h3>üìã Email Logs</h3>
          <div class="filter-bar">
            <select id="email-log-status-filter">
              <option value="">All</option>
              <option value="sent">Sent</option>
              <option value="failed">Failed</option>
            </select>
            <button class="btn mini ghost" id="email-log-refresh">Refresh</button>
          </div>
          <div class="data-table" id="email-log-table">
            <div class="table-head email-log-head">
              <span>Recipient</span>
              <span>Template</span>
              <span>Subject</span>
              <span>Status</span>
              <span>Time</span>
            </div>
            <div class="table-body" id="email-log-rows">
              <p class="empty">Loading logs‚Ä¶</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Campaign Composer -->
      <section class="tab-panel" data-panel="campaigns">
        <div class="panel-head">
          <h2>Campaign Composer</h2>
        </div>
        <form id="campaign-form" class="card-form">
          <label class="form-field">
            <span>Segment / Group</span>
            <select name="segment" id="campaign-segment">
              <option value="">All Active</option>
              <option value="spin_wheel">Spin Wheel</option>
              <option value="popup">Popup</option>
              <option value="newsletter_signup">Newsletter Signup</option>
            </select>
          </label>
          <label class="form-field">
            <span>Subject</span>
            <input type="text" name="subject" placeholder="Weekly Drop Alert" required />
          </label>
          <label class="form-field">
            <span>HTML Content</span>
            <textarea name="html" rows="12" placeholder="<h1>Hello!</h1><p>Check out our latest deals...</p>"></textarea>
          </label>
          <div class="form-actions">
            <label class="form-field inline">
              <span>Test Email</span>
              <input type="email" name="testEmail" placeholder="test@example.com" />
            </label>
            <button type="button" class="btn ghost" id="campaign-test">Send Test</button>
            <button type="submit" class="btn primary" id="campaign-send">Send to All Active</button>
          </div>
        </form>
      </section>

      <!-- Deals Management -->
      <section class="tab-panel" data-panel="deals">
        <div class="panel-head">
          <h2>Deals / Spotlights</h2>
        </div>
        <div class="card">
          <h3>üîó G2A Reflink Repair</h3>
          <p style="margin:0 0 1rem;opacity:.7;font-size:.9rem;">Scan all spotlights and ensure every G2A URL contains your affiliate <code>gtag</code> parameter.</p>
          <button class="btn primary" id="g2a-fix-btn">Fix G2A Links</button>
          <div id="g2a-fix-result" style="display:none;margin-top:1rem;">
            <div class="stats-row" id="g2a-fix-stats"></div>
            <div id="g2a-fix-examples" style="margin-top:.75rem;"></div>
          </div>
        </div>
      </section>

      <!-- Gaming Drops Manager -->
      <section class="tab-panel" data-panel="drops">
        <div class="panel-head">
          <h2>Gaming Drops</h2>
        </div>
        <div class="card">
          <h3>üéÆ Manage Drops</h3>
          <p style="margin:0 0 1rem;opacity:.7;font-size:.9rem;">Configure outbound gaming credit links. G2A URLs are automatically tagged with your affiliate gtag on save.</p>
          <div class="data-table" id="drops-table">
            <div class="table-head drops-head">
              <span>ID</span>
              <span>Title</span>
              <span>Platform</span>
              <span>URL</span>
              <span>Active</span>
              <span>Order</span>
              <span>Actions</span>
            </div>
            <div class="table-body" id="drops-rows">
              <p class="empty">Loading drops‚Ä¶</p>
            </div>
          </div>
        </div>
        <div class="card">
          <h3>‚ûï Add / Edit Drop</h3>
          <form id="drop-form" class="card-form" style="border:none;padding:0;">
            <div class="form-row">
              <label class="form-field">
                <span>ID (slug)</span>
                <input type="text" id="drop-id" placeholder="e.g. nintendo15" required />
              </label>
              <label class="form-field">
                <span>Title</span>
                <input type="text" id="drop-title" placeholder="Nintendo eShop 15‚Ç¨" />
              </label>
            </div>
            <div class="form-row">
              <label class="form-field">
                <span>Platform</span>
                <input type="text" id="drop-platform" placeholder="Nintendo" />
              </label>
              <label class="form-field">
                <span>Value (EUR)</span>
                <input type="number" id="drop-value" placeholder="15" />
              </label>
            </div>
            <label class="form-field">
              <span>Destination URL</span>
              <input type="url" id="drop-url" placeholder="https://www.g2a.com/n/nintendo15_lux" required />
            </label>
            <div class="form-row">
              <label class="form-field">
                <span>Sort Order</span>
                <input type="number" id="drop-sort" value="0" />
              </label>
              <label class="form-field inline" style="align-items:center;gap:.5rem;">
                <input type="checkbox" id="drop-active" checked />
                <span>Active</span>
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn primary">Save Drop</button>
              <button type="button" class="btn ghost" id="drop-reset">Reset Form</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Spotlight Manager -->
      <section class="tab-panel" data-panel="spotlight">
        <div class="panel-head">
          <h2>Spotlight Pages</h2>
        </div>

        <!-- Stats -->
        <div class="stats-row" id="spotlight-stats">
          <div class="stat-card">
            <span class="stat-label">Total Pages</span>
            <strong class="stat-value" id="spotlight-stat-total">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Active</span>
            <strong class="stat-value" id="spotlight-stat-active">‚Äì</strong>
          </div>
          <div class="stat-card">
            <span class="stat-label">Total Clicks</span>
            <strong class="stat-value" id="spotlight-stat-clicks">‚Äì</strong>
          </div>
        </div>

        <!-- Spotlight List -->
        <div class="card">
          <h3>üìÑ All Spotlight Pages</h3>
          <div class="data-table" id="spotlight-table">
            <div class="table-head spotlight-head">
              <span>Title</span>
              <span>Brand</span>
              <span>Slug</span>
              <span>Clicks</span>
              <span>Active</span>
              <span>Actions</span>
            </div>
            <div class="table-body" id="spotlight-rows">
              <p class="empty">Loading spotlights‚Ä¶</p>
            </div>
          </div>
        </div>

        <!-- 1-Click Templates -->
        <div class="card">
          <h3>üé® 1-Click Templates</h3>
          <p style="color:rgba(255,255,255,.5);font-size:.85rem;margin-bottom:.75rem;">Apply to empty fields. Hold <kbd style="background:rgba(255,255,255,.1);padding:.1rem .4rem;border-radius:4px;font-size:.8rem;">Alt/Option</kbd> + click to overwrite existing values.</p>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.75rem;" id="spotlight-template-buttons">
            <button type="button" class="btn mini" data-template="temu" style="background:linear-gradient(135deg,#f97316,#a855f7);color:#fff;">Temu Viral</button>
            <button type="button" class="btn mini" data-template="amazon" style="background:linear-gradient(135deg,#f59e0b,#06b6d4);color:#fff;">Amazon Prime Deal</button>
            <button type="button" class="btn mini" data-template="g2a" style="background:linear-gradient(135deg,#3b82f6,#a855f7);color:#fff;">G2A Gaming Key</button>
            <button type="button" class="btn mini ghost" data-template="neutral">Neutral (DropCharge)</button>
          </div>
          <label class="form-field inline" style="align-items:center;gap:.5rem;">
            <input type="checkbox" id="spotlight-auto-template" />
            <span style="font-size:.85rem;">Auto-apply template based on URL domain</span>
          </label>
        </div>

        <!-- Create / Edit Form -->
        <div class="card">
          <h3 id="spotlight-form-title">‚ûï Create Spotlight Page</h3>
          <form id="spotlight-form" class="card-form" style="border:none;padding:0;">
            <input type="hidden" id="spotlight-edit-id" />
            <input type="hidden" id="spotlight-theme" value="" />
            <div class="form-row">
              <label class="form-field">
                <span>Title (H1)</span>
                <input type="text" id="spotlight-title" placeholder="Temu 50% Billiger" required />
              </label>
              <label class="form-field">
                <span>Slug (URL path)</span>
                <input type="text" id="spotlight-slug" placeholder="temu-50 (auto-generated)" />
              </label>
            </div>
            <label class="form-field">
              <span>Subtitle</span>
              <input type="text" id="spotlight-subtitle" placeholder="Exclusive limited-time deal" />
            </label>
            <div class="form-row">
              <label class="form-field">
                <span>Brand Name</span>
                <input type="text" id="spotlight-brand" placeholder="Temu, Amazon, Steam‚Ä¶" />
              </label>
              <label class="form-field">
                <span>Badge Text</span>
                <input type="text" id="spotlight-badge" placeholder="-50%, EXCLUSIVE, LIMITED" />
              </label>
            </div>
            <label class="form-field">
              <span>Affiliate URL</span>
              <div class="input-with-actions">
                <input type="url" id="spotlight-affiliate-url" placeholder="https://affiliate.example.com/‚Ä¶" required />
                <button type="button" class="btn mini" id="spotlight-autofill-btn">Auto-Fill from Link</button>
                <button type="button" class="btn mini ghost" id="spotlight-suggest-slug-btn">Suggest Slug</button>
              </div>
              <div id="spotlight-autofill-status" class="autofill-status" style="display:none;"></div>
            </label>
            <div class="form-row">
              <label class="form-field">
                <span>Coupon Code (optional)</span>
                <input type="text" id="spotlight-coupon" placeholder="SAVE50" />
              </label>
              <label class="form-field">
                <span>CTA Button Text</span>
                <input type="text" id="spotlight-cta" placeholder="Jetzt sichern" />
              </label>
            </div>
            <div class="form-row">
              <label class="form-field">
                <span>Logo URL</span>
                <input type="url" id="spotlight-logo-url" placeholder="https://‚Ä¶/logo.png" />
              </label>
              <label class="form-field">
                <span>Hero Image URL</span>
                <input type="url" id="spotlight-hero-url" placeholder="https://‚Ä¶/hero.jpg" />
              </label>
            </div>
            <div class="form-row">
              <label class="form-field">
                <span>Background Gradient</span>
                <select id="spotlight-gradient">
                  <option value="linear-gradient(135deg, #7c3aed, #06b6d4)">Violet ‚Üí Cyan (Default)</option>
                  <option value="linear-gradient(135deg, #f97316, #a855f7)">Orange ‚Üí Violet Neon (Temu Pulse)</option>
                  <option value="linear-gradient(135deg, #f59e0b, #06b6d4)">Amber ‚Üí Cyan (Prime Glow)</option>
                  <option value="linear-gradient(135deg, #3b82f6, #a855f7)">Electric Blue ‚Üí Violet (Gaming Neon)</option>
                  <option value="linear-gradient(135deg, #f97316, #ef4444)">Orange ‚Üí Red (Temu)</option>
                  <option value="linear-gradient(135deg, #f59e0b, #f97316)">Gold ‚Üí Orange (Amazon)</option>
                  <option value="linear-gradient(135deg, #1b2838, #2a475e)">Dark Blue (Steam)</option>
                  <option value="linear-gradient(135deg, #e40012, #8b0000)">Red (Nintendo)</option>
                  <option value="linear-gradient(135deg, #107c10, #0e6b0e)">Green (Xbox)</option>
                  <option value="linear-gradient(135deg, #003087, #0070d1)">Blue (PlayStation)</option>
                  <option value="linear-gradient(135deg, #ec4899, #8b5cf6)">Pink ‚Üí Purple</option>
                  <option value="linear-gradient(135deg, #10b981, #06b6d4)">Emerald ‚Üí Cyan</option>
                </select>
              </label>
              <label class="form-field">
                <span>Countdown Date (optional)</span>
                <input type="datetime-local" id="spotlight-countdown" />
              </label>
            </div>
            <div class="form-row">
              <label class="form-field inline" style="align-items:center;gap:.5rem;">
                <input type="checkbox" id="spotlight-active" checked />
                <span>Active</span>
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn primary" id="spotlight-save-btn">Create Spotlight</button>
              <button type="button" class="btn ghost" id="spotlight-reset">Reset Form</button>
              <button type="button" class="btn ghost" id="spotlight-preview-btn" style="display:none;">Preview</button>
            </div>
          </form>
        </div>
      </section>

      <!-- Tracking Link Generator -->
      <section class="tab-panel" data-panel="tracking">
        <div class="panel-head">
          <h2>Tracking Link Generator</h2>
        </div>
        <form id="tracking-form" class="card-form">
          <label class="form-field">
            <span>Slug</span>
            <input type="text" name="slug" placeholder="e.g. psn-summer-deal" required />
          </label>
          <div class="form-row">
            <label class="form-field">
              <span>UTM Source</span>
              <input type="text" name="utm_source" placeholder="e.g. tiktok" />
            </label>
            <label class="form-field">
              <span>UTM Medium</span>
              <input type="text" name="utm_medium" placeholder="e.g. social" />
            </label>
          </div>
          <div class="form-row">
            <label class="form-field">
              <span>UTM Campaign</span>
              <input type="text" name="utm_campaign" placeholder="e.g. summer-sale" />
            </label>
            <label class="form-field">
              <span>UTM Content</span>
              <input type="text" name="utm_content" placeholder="e.g. banner-top" />
            </label>
          </div>
          <button type="submit" class="btn primary">Generate Link</button>
        </form>
        <div id="tracking-result" class="result-box" style="display:none;">
          <p><strong>Generated Link:</strong></p>
          <code id="tracking-url"></code>
          <button class="btn mini ghost" id="copy-tracking-url">Copy</button>
        </div>
      </section>

      <!-- Analytics -->
      <section class="tab-panel" data-panel="analytics">
        <div class="panel-head">
          <h2>Analytics</h2>
        </div>
        <div class="card">
          <h3>Top 10 Links by Clicks</h3>
          <div class="data-table">
            <div class="table-head analytics-head">
              <span>Slug</span>
              <span>Clicks</span>
            </div>
            <div class="table-body" id="analytics-rows">
              <p class="empty">Loading analytics‚Ä¶</p>
            </div>
          </div>
        </div>
        <div class="card">
          <h3>Latest Events</h3>
          <div class="data-table">
            <div class="table-head events-head">
              <span>Type</span>
              <span>Slug</span>
              <span>Time</span>
            </div>
            <div class="table-body" id="events-rows">
              <p class="empty">Loading events‚Ä¶</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <div id="toast" class="toast"></div>
  <script type="module" src="./assets/admin.js"></script>
</body>
</html>
